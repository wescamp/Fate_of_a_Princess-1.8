#textdomain wesnoth-Fate_of_a_Princess
[scenario]
    id=21_Fate_of_a_Princess
    name= _ "Fate of a Princess"
    next_scenario=22_Epilogue
    map_data="{~add-ons/Fate_of_a_Princess/maps/21_Fate_of_a_Princess.map}"
    [story]
        [part]
            story= _ "Háwclyn, Queen Eämeral, and his troops streamed through the portal as quickly as they could. The chamber beyond had a chilling and powerful aura, so strong the even the non-mages could feel it."
        [/part]
        [part]
            show_title=yes
            background=story/farnorth-southeast.jpg
            {NEW_BATTLE 626 429}
        [/part]
    [/story]
    {SCENARIO_MUSIC "the_deep_path.ogg"}
    {EXTRA_SCENARIO_MUSIC "suspense.ogg"}
    {EXTRA_SCENARIO_MUSIC "heroes_rite.ogg"}
    {TURNS 60 55 50}
    {UNDERGROUND}
    victory_when_enemies_defeated=no
    [side]
        {SIDE_1}
        {GOLD 350 300 250}
        fog=no
        shroud=yes
        {FOAP_RECRUIT_5}
        {INCOME 4 2 1}
        village_gold=1
    [/side]
    [side]
        side=2
        controller=ai
        type=Necromancer
        gender=male
        team_name=Gulder
        name= _ "Gulder"
        id=Gulder
        profile=portraits/humans/transparent/dark-adept.png
        unrenamable=yes
        user_team_name=_"Gulder"
        {GOLD 0 0 0}
        {INCOME 0 0 0}
        canrecruit=yes
        recruit=Revenant,Bone Shooter,Shadow
        [ai]
            village_value=2.0
            leader_village=50.0                                           
            recruitment_pattern=fighter,archer,fighter,fighter,scout,fighter,fighter,archer,fighter,fighter,scout,fighter
            passive_leader=yes
        [/ai]
    [/side] 
    [side]
        side=3
        controller=ai
        type=Death Knight
        id=Death Knight
        name= _ "Elexer Nocti"
        team_name=Gulder
        user_team_name=_"Undead"
        {GOLD 0 0 0}
        {INCOME 0 0 0}
        canrecruit=yes
        recruit=Deathblade,Bone Shooter,Wraith
        [ai]
            village_value=2.0
            leader_village=50.0                                           
            recruitment_pattern=fighter,archer,fighter,archer,scout,fighter
            passive_leader=yes
        [/ai]
    [/side]
    [side]
        side=4
        controller=ai
        type=Draug
        id=Draug
        name= _ "Draug"
        team_name=Gulder
        user_team_name=_"Undead"
        {GOLD 200 240 280}
        {INCOME 40 80 120}
        canrecruit=yes
        recruit=Revenant,Bone Shooter
        [ai]
            village_value=2.0
            leader_village=50.0                                           
          recruitment_pattern=fighter,fighter,archer,fighter,fighter,archer
        [/ai]
    [/side]
    [side]
        side=5
        controller=ai
        type=Dark Sorcerer
        id=Ukyle
        name= _ "Ukyle"
        team_name=Gulder
        user_team_name=_"Gulder"       
        {GOLD 100 120 140}
        {INCOME 10 15 20}
        canrecruit=yes
        recruit=Skeleton,Skeleton Archer
        [ai]
          recruitment_pattern=fighter,fighter,archer,fighter,fighter,archer
          passive_leader=no
        [/ai]
    [/side]
    [side]
        side=6
        no_leader=yes
        controller=ai
        team_name=Gulder
        user_team_name=_"Gulder"
    [/side]
    [event]
        name=start
        [message]
            id=Hawclyn
            message= _ "What a hellish place! Vampire bats ... no doubt there is worse to come."
        [/message]
        [message]
            id=Eameral
            message= _ "Gulder is very near. But there will be other horrors to face as well."
        [/message]
    [/event]
    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Defeat the enemy leader"
                condition=win
            [/objective]
            {FOAP_HOW_TO_LOSE_4}
        [/objectives]
        [recall]
            id=Zylvia
            x,y=34,4
            facing="sw"
        [/recall]
        [recall]
            id=Shoko
            x,y=31,3
            facing="sw"
        [/recall]
        [recall]
            id=Turuk
            x,y=32,3
            facing="sw"
        [/recall]
        [recall]
            id=Rambaltas
            x,y=33,4
            facing="sw"
        [/recall]
        [recall]
            id=Ameck
            x,y=31,4
            facing="sw"
        [/recall]
        [recall]
            id=Nardras
            x,y=30,3
            facing="sw"
        [/recall]
        [unit]
            side=1
            type=Elvish Royal
            id=Eameral
            name= _ "Queen Eämeral"
            profile="portraits/elves/transparent/shyde.png"
            unrenamable=yes
            {IS_HERO}
            x=33
            y=5
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type=Vampire Bat
            side=5
            x,y=31,10
        [/unit]
        [unit]
            type=Vampire Bat
            side=5
            x,y=27,8
        [/unit]
        {OBJ_POTION_HOLY 31 19 object7_holywater}
        {OBJ_POTION_HOLY 27 19 object7_holywater2}
        [item]
            image=items/ladder.png
            x,y=35,3
        [/item]
        [event]
            name=moveto
            first_time_only=yes
            [filter]
                side=1
                x=28-34
                y=13-14
            [/filter]
            [terrain]
                x=28-30
                y=16-17
                terrain=Rr
            [/terrain]
            [message]
                id=Hawclyn
                message= _ "What is that? The wall is moving."
            [/message]
        [/event]
        [set_variable]
            name=gulder_event
            value=0
        [/set_variable]
        [set_variable]
            name=ukyle_event
            value=0
        [/set_variable]
    [/event]
    [event]
        name=sighted
        [filter]
            type=Skeleton
            side=5
            [or]
                type=Skeleton Archer
                side=5
            [/or]
        [/filter]
        [remove_shroud]
        	side=1
        	x,y=$x1,$y1
        [/remove_shroud]
        [scroll_to]
        	x,y=$x1,$y1
        [/scroll_to]
        [delay]
        	time=150
        [/delay]
        [message]
            id=Zylvia
            message= _ "Undead? Why are they in Dorest?"
        [/message]
        [message]
            id=Eameral
            message= _ "Hmmm ... that is why ... those holy waters are probably for people in Dorest when they see Gulder."
        [/message]
    [/event]
    [event]
       name=moveto
       first_time_only=no
       [filter]
              side=1
       [/filter]
       [if]
              [have_unit]
                       id=Ukyle
                       [filter_vision]
                             visible=yes
                             viewing_side=1
                       [/filter_vision]
              [/have_unit]
              [and]
                   [not]
                       [variable]
                             name=ukyle_event
                             numerical_equals=1
                       [/variable]
                    [/not]
              [/and]
              [then]
                    [set_variable]
                            name=ukyle_event
                            value=1
                     [/set_variable]
                     [scroll_to_unit]
                            id=Ukyle
                     [/scroll_to_unit]
                     [delay]
        		            time=150
		             [/delay]
                     [message]
                            id=Hawclyn
                            message= _ "Someone is there! Is that Gulder?"
                     [/message]
                     [message]
                            id=Ukyle
                            message= _ "....."
                     [/message]
                     [message]
                            id=Eameral
                            message= _ "No, I think not. Power is much less than one in Gulder. Must be someone else."
                     [/message]
              [/then]
              [else]
                      [allow_undo]
                      [/allow_undo]
              [/else]
       [/if]
    [/event]
    [event]
        name=turn 12
        [message]
            id=Turuk
            message= _ "Are you sure that Gulder is here, Queen Eämeral? It seems just the nest of undead."
        [/message]
        [message]
            id=Eameral
            message= _ "I am positive."
        [/message]
    [/event]
    [event]
       name=moveto
       first_time_only=yes
       [filter]
           side=1
           x=13,14-15,16-18,19-20,21
           y=23-27,22-26,21-25,22-25,22-26
       [/filter]
       [message]
           id=Hawclyn
           message= _ "It seems there is nothing here."
       [/message]
       [message]
           id=Eameral
           message= _ "No, there is something, Háwclyn!"
       [/message]
       [unit]
           type=Nightgaunt
           id=Cavewall Phantom
           x,y=20,23
           {FOAP_NIGHT_GRANT}
       [/unit]
    [/event]
    [event]
        name=die
        [filter]
            id=Cavewall Phantom
        [/filter]
        [terrain]
            x,y=4,22
            terrain=Rr
        [/terrain]
        [message]
            id=Eameral
            message= _ "I have just figured it out how Gulder used the magic to create this cave. It was a phantom of the cave wall."
        [/message]
        [unit]
           type=Nightgaunt
           id=Cavewall Phantom 2
           x,y=22,24
           {FOAP_NIGHT_GRANT}
        [/unit]
        [unit]
           type=Nightgaunt
           id=Cavewall Phantom 3
           x,y=22,22
           {FOAP_NIGHT_GRANT}
        [/unit]
        [unit]
           type=Nightgaunt
           id=Cavewall Phantom 4
           x,y=24,25
           {FOAP_NIGHT_GRANT}
        [/unit]
        [unit]
           type=Nightgaunt
           id=Cavewall Phantom 5
           x,y=24,23
           {FOAP_NIGHT_GRANT}
        [/unit]
        [unit]
           type=Nightgaunt
           id=Cavewall Phantom 6
           x,y=24,21
           {FOAP_NIGHT_GRANT}
        [/unit]
        [unit]
           type=Nightgaunt
           id=Cavewall Phantom 7
           x,y=25,22
           {FOAP_NIGHT_GRANT}
        [/unit]
        [unit]
           type=Nightgaunt
           id=Cavewall Phantom 8
           x,y=25,24
           {FOAP_NIGHT_GRANT}
        [/unit]
        [modify_side]
            side=2
            {GOLD 220 250 280}
            {INCOME 40 60 80}
        [/modify_side]
        [modify_side]
            side=3
            {GOLD 220 250 280}
            {INCOME 40 60 80}
        [/modify_side]
    [/event]
    {FOAP_CAVE_WALL}
    [event]
       name=moveto
       first_time_only=no
       [filter]
              side=1
       [/filter]
       [if]
              [have_unit]
                       id=Gulder
                       x=20
                       y=10
                       [filter_vision]
                             visible=yes
                             viewing_side=1
                       [/filter_vision]
              [/have_unit]
              [and]
                   [not]
                       [variable]
                             name=gulder_event
                             numerical_equals=1
                       [/variable]
                    [/not]
              [/and]
              [then]
                    [set_variable]
                            name=gulder_event
                            value=1
                     [/set_variable]
                     [scroll_to_unit]
                            id=Gulder
                     [/scroll_to_unit]
                     [delay]
        		    time=150
		     [/delay]
                     [message]
                            id=Ameck
                            message= _ "That is Gulder, right there!"
                     [/message]
	             [music]
	                    name=frantic.ogg
	                    play_once=yes
	             [/music]
                     [message]
                            id=Gulder
                            message= _ "Welcome! Welcome! I was planning to kill you after I had brought all the elves of the Greenwood through the gates of hell. So obliging of you to step through of your own accord and save me the trouble!"
                     [/message]
                     [message]
                            id=Hawclyn
                            message= _ "We are here to kill you, Gulder. We will send you back into the pits of hell on your own."
                     [/message]
                     [message]
                            id=Gulder
                            message= _ "Hahahaha! Foolish, impudent whelp! I thought the Greenwood elves were as stupid as trolls, but I overestimated you! I learned the undead arts from Jevyan himself! You cannot hope to oppose me!"
                     [/message]
                     [message]
                            id=Zylvia
                            message= _ "You're deluded! The monster Jevyan was destroyed more than two centuries ago!"
                     [/message]
                     [message]
                            id=Eameral
                            message= _ "Alas, the shades of the most powerful lords of the undead can return to this world from time to time, with the correct rituals. Once every thirteen years, I believe."
                     [/message]
                     [message]
                            id=Gulder
                            message= _ "Oho, your majesty! Not quite as ignorant as your doltish subjects, I see! Yes, I saw his seventeenth return in this world, and I went back with him to his palace in the ethernal blackness, and stayed there another thirteen years to lean the undead arts. Then on his eighteenth return, I came back with him! Hahahahahahaha! I have been building my power more than five-times stronger since!"
                     [/message]
                     [message]
                            id=Ameck
                            message= _ "Gulder, stop this madness! I am sorry for death of your father, but it was an accident, and it has nothing to do with the people of Dorest or the elves of the Greenwood."
                     [/message]
                     [message]
                            id=Gulder
                            message= _ "Silence, witch! You killed my father. He was my only family. My mother, Fioniel, left my father when he accepted growing you from the elven High Lord. If he had not ordered my father, he would still be alive, and my mother hadn't left my father. And also if your father had not come to Dorest, you wuold never have been born, you twisted half-breed! You should never have been born in this world!"
                     [/message]
                     [message]
                         id=Ameck
                         message= _ "Uh!"
                     [/message]
                     [message]
                            id=Turuk
                            message= _ "Why are we even talkin' tae these dried-up old remains?! His heid's cracked! His brain's spoiled! Back intae the pit wi' him, I say!"
                     [/message]
                     #ifdef EASY
                     	[gold]
                     		amount=150
                     		side=2
                     	[/gold]
                     #endif
                     #ifdef NORMAL
                     	[gold]
                     		amount=180
                     		side=2
                     	[/gold]
                     #endif
                     #ifdef HARD
                     	[gold]
                     		amount=200
                     		side=2
                     	[/gold]
                     #endif
                     [object]
        	              id=add_new_ability
        	              duration=forever
        	              [filter]
        		              id=Gulder
        	              [/filter]
        	              silent=yes
        	              [effect]
                             apply_to=new_ability
                             [abilities]
                                 {ABILITY_REGENERATES}
                             [/abilities]
                         [/effect]
	                  [/object]      
              [/then]
              [else]
                      [allow_undo]
                      [/allow_undo]
              [/else]
       [/if]
    [/event]
      
    [event]
        name=attack
        [filter]
            side=1
        [/filter]
        [filter_second]
            id=Gulder
        [/filter_second]
        [message]
            id=Gulder
            message= _ "Hahahaha, you think that you can kill me??"
        [/message]
        [terrain]
        	x=6,6
        	y=5,6
        	terrain=Cud
        [/terrain]
        [terrain]
        	x=7
        	y=6
        	terrain=Kh
        [/terrain]
        [terrain]
        	x=7-8,7,8
        	y=5,7,6
        	terrain=Chw
        [/terrain]
        [redraw]
        [/redraw]
        [remove_shroud]
            side=1
            x=1-36
            y=1-27
        [/remove_shroud]
        {MOVE_UNIT id=Gulder 7 6}
        [modify_side]
            side=2
            {GOLD 300 350 400}
            recruit=Draug,Banebow,Spectre
            [ai]
                [avoid]
                    x=1-7,9-12
                    y=1-5,9-12
                [/avoid]
                passive_leader=yes
           recruitment_pattern=scout,fighter,archer,fighter,archer,fighter
            [/ai]
        [/modify_side]      
        
        [object]
        	id=add_resistance
        	duration=forever
        	[filter]
        		id=Gulder
        	[/filter]
        	silent=yes
        	[effect]
        		apply_to=resistance
        		replace=true
        		[resistance]
        			blade=10
				pierce=10
				impact=10
				fire=10
				cold=10
				arcane=10
			[/resistance]
		   [/effect]
        [/object]
	     [music]
	        name=frantic.ogg
	        play_once=yes
	     [/music]
        [message]
            id=Gulder
            message= _ "Hahaha, I will show you how much power I got.
Come on friends! Show yourselves!"
        [/message]
        [unit]
            type=Spectre
            side=2
            x,y=13,6
        [/unit]
        [unit]
            type=Spectre
            side=2
            x,y=10,7
        [/unit]
        [unit]
            type=Draug
            side=2
            x,y=8,6
        [/unit]
        [unit]
            type=Banebow
            side=2
            x,y=8,5
        [/unit]
        [unit]
            type=Draug
            side=2
            x,y=7,5
        [/unit]
        [unit]
            type=Banebow
            side=2
            x,y=7,7
        [/unit]
        [unit]
            type=Draug
            side=2
            x,y=6,6
        [/unit]
        [unit]
            type=Banebow
            side=2
            x,y=6,5
        [/unit]
#ifdef EASY
        [unit]
            type=Draug
            side=2
            x,y=16,7
        [/unit]
        [unit]
            type=Draug
            side=2
            x,y=14,8
        [/unit]
        [unit]
            type=Banebow
            side=2
            x,y=15,8
        [/unit]
        [unit]
            type=Skeletal Dragon
            side=2
            x,y=10,4
        [/unit]
#endif 
#ifdef NORMAL
        [unit]
            type=Draug
            side=2
            x,y=16,7
        [/unit]
        [unit]
            type=Draug
            side=2
            x,y=14,8
        [/unit]
        [unit]
            type=Banebow
            side=2
            x,y=15,8
        [/unit]
        [unit]
            type=Draug
            side=2
            x,y=17,7
        [/unit]
        [unit]
            type=Banebow
            side=2
            x,y=13,9
        [/unit]
        [unit]
            type=Skeletal Dragon
            side=2
            x,y=12,8
        [/unit]
        [unit]
            type=Skeletal Dragon
            side=2
            x,y=17,6
        [/unit]
#endif
#ifdef HARD
        [unit]
            type=Draug
            side=2
            x,y=16,7
        [/unit]
        [unit]
            type=Draug
            side=2
            x,y=14,8
        [/unit]
        [unit]
            type=Banebow
            side=2
            x,y=15,8
        [/unit]
        [unit]
            type=Draug
            side=2
            x,y=17,7
        [/unit]
        [unit]
            type=Banebow
            side=2
            x,y=13,9
        [/unit]
        [unit]
            type=Draug
            side=2
            x,y=15,9
        [/unit]
        [unit]
            type=Banebow
            side=2
            x,y=16,8
        [/unit]
        [unit]
            type=Skeletal Dragon
            side=2
            x,y=10,4
        [/unit]
        [unit]
            type=Skeletal Dragon
            side=2
            x,y=17,6
        [/unit]
        [unit]
            type=Skeletal Dragon
            side=2
            x,y=12,8
        [/unit]
#endif
        [message]
            id=Hawclyn
            message= _ "Ummm ... it seems he did not lie."
        [/message]
        [objectives]
            side=1
            [objective]
                description= _ "Have Ameck attack Gulder"
                condition=win
            [/objective]
            {FOAP_HOW_TO_LOSE_4}
        [/objectives]
        [sound]
            name=bell.wav
        [/sound]
    [/event]
    [event]
        first_time_only=no
        name=moveto
        [filter]
            id=Ameck
            x=6-8,7
            y=5-6,7
        [/filter]
        [if]
        	[have_unit]
        		id=Gulder
        		x,y=7,6
        	[/have_unit]
        	[then]
               [message]
                   id=Ameck
                   message= _ "Gulder! I cannot let you keep doing this! I recognize you have increased your power which exceeded the power myself, but I have a talisman from my mother. It increases my power doubled. This is my final weapon to make you quiet, the royal talisman. Take it!"
               [/message]
               [store_unit]
			[filter]
				id=Gulder
			[/filter]
		 	variable=temp_gulder
		[/store_unit]
				 {FLASH_BLUE (
				 [sound]
					 name=explosion.ogg
				 [/sound]
				 )}
		[set_variable]
			name=temp_gulder.hitpoints
			add=-3
		[/set_variable]
		[unstore_unit]
			variable=temp_gulder
			text=3
			{COLOR_HARM}
		[/unstore_unit]
				 {FLASH_BLUE (
				 [sound]
					 name=explosion.ogg
				 [/sound]
				 )}
		[set_variable]
			name=temp_gulder.hitpoints
			add=-3
		[/set_variable]
		[unstore_unit]
			variable=temp_gulder
			text=3
			{COLOR_HARM}
		[/unstore_unit]
		[clear_variable]
			name=temp_gulder
		[/clear_variable]
              [message]
                  id=Gulder
                  message= _ "Ha ha, barely scratched me!"
              [/message]
              [message]
                  id=Hawclyn
                  message= _ "What? It does not work to him? It was clear hit, and the most powerful attack I have ever seen."
              [/message]
              [message]
                  id=Eameral
                  message= _ "I am afraid he said his power has been increased more than five-times. It means the power is about ten times greater than his father, Gulcyn; on the other hand, the power of Alingwen is probably four times more than Gulcyn, even with the talisman, eight-times, so still less than one on current Gulder."
              [/message] 
                  
              [message]
                  id=Ameck
                  message= _ "Uh! I am going to need both talismans from my mother! Even the backlash destroy me, it will be the only way to defeat him. No one else can do. I am in the fate of it!"
              [/message]
              [message]
                  speaker=narrator
                  message= _ "The talismans from Queen Melindë were the symbol of the Greenwood. They were made one by the chosen elves of the northern Greenwood, and another by the chosen elves of the southern Greenwood right after the Battle of Dorest to save Queen Melindë. If the both talismans get together, the power of them would be incredibly increased."
                  image=wesnoth-icon.png
              [/message]   
        		[message]
         		    id=Eameral
       			    message= _ "Háwclyn! Pass the talisman I gave you to Alingwen, quickly! I do not want to, but this is the only way to be able to defeat him."
        		[/message]
		        [message]
		            id=Hawclyn
		            message= _ "Yeh, Yes, ma'am!"
		        [/message]
		        
		        [store_unit]
		        	[filter]
		        		id=Hawclyn
		        	[/filter]
		        	variable=temp_hawclyn
		        [/store_unit]
		        [move_unit_fake]
		        	type=Amulet
		        	x=$temp_hawclyn.x,$x1
		        	y=$temp_hawclyn.y,$y1
		        [/move_unit_fake]
		        [clear_variable]
		        	name=temp_hawclyn
		        [/clear_variable]
		        			        
        		[message]
        		    speaker=narrator
       			    message= _ "Háwclyn threw the talisman to Ameck as fast as he can, and Ameck received it quietly, then she talked to Gulder calmly."
       			    image=wesnoth-icon.png
       			[/message]
        		[message]
      	       		    id=Ameck
		            message= _ "You said that you leaned the undead art from Jevyan, but you are the son of Gulcyn, not the undead. The pulse you use is still beatable if I have two talismans together. 
You told me that I should not have been born in this world. You are wrong! I am half Greenwood elf, half Dorest human. I was born to save the people of Dorest and the elves of the Greenwood. This will be the final weapon of justice. Take it!"
		        [/message] 
		        
 		       [message]
		            id=Turuk
		            message= _ "Get down everybody! Get down!"
		        [/message]
              [message]
                  id=Zylvia
                  message= _ "Nooooo ... Princess Alingwen! ... Nooooo ..."
              [/message]
				 {FLASH_BLUE (
				 [sound]
					 name=explosion.ogg
				 [/sound]
				 )}
				 {FLASH_GREEN (
				 [sound]
					 name=explosion.ogg
				 [/sound]
				 )}
		        [message]
		            id=Gulder
		            message= _ "What are you do- ... A ... a ... a ... Aaaargh!"
		        [/message]
				 {FLASH_BLUE (
				 [sound]
					 name=explosion.ogg
				 [/sound]
				 )}
				 {FLASH_GREEN (
				 [sound]
					 name=explosion.ogg
				 [/sound]
				 )}
               [sound]
                   name=human-die-1.ogg
               [/sound]
		        [kill]
		            id=Gulder
		            animate=yes
		        [/kill]
		        [kill]
 		               id=Ameck
 		               animate=yes
		        [/kill]
		        [redraw]
		        [/redraw]
               [music]
                   name=love_theme.ogg
                   immediate=yes
               [/music]
               		[delay]
		        	time=100
		        [/delay]
 		        [endlevel]
                   result=victory
                   save=yes
                   carryover_report=no
                   carryover_percentage=100
                   linger_mode=no
                   bonus=no
		            next_scenario=22_Epilogue
		        [/endlevel]
		[/then]
		[else]
			[allow_undo]
			[/allow_undo]
		[/else]
	[/if]
    [/event]
        {FOAP_CHAOTIC_UNIT_LEVELUP}    
        {FOAP_RESOLVE_STONE_PROBLEM}
        {FOAP_LOYAL_UNIT_DEATHS}
        {FOAP_HERO_DEATHS}
        {FOAP_TIME_OVER}
[/scenario]